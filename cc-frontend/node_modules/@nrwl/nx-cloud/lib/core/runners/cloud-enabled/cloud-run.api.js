const a3_0x437c=['error','application/octet-stream','note','headers','runContext','gzip','createMetricRecorder','axiosMultipleTries','apiAxiosInstance','RunEnd.\x20Completed\x20tasks','length','zlib','done','machineInfo','messages','message','RunStart','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','../../../utilities/nx-imports','terminalOutput','stack','../../../utilities/environment','recordMetric','apiError','success','VERBOSE_LOGGING','apply','string','post','stringify','api','next','axiosException','Invalid\x20end\x20run\x20response','defaults','urls','map','__awaiter','endRun','parse','unknown','Stack\x20Trace:','mapRespToPerfEntry','data','runUrl','throw','Run\x20completion\x20responded\x20with\x20`undefined`.','Run\x20Details:','response','Invalid\x20end\x20run\x20response:\x20','../../../utilities/axios','value','then','util','extractErrorMessage','defineProperty','CloudRunApi','assign','RUNNER_FAILURE_PERF_ENTRY','...','createReqBody','status','promisify','nxCloudVersion','from','/nx-cloud/runs/end'];(function(_0x1b6ad2,_0x437cb8){const _0x2b7e84=function(_0xb05a69){while(--_0xb05a69){_0x1b6ad2['push'](_0x1b6ad2['shift']());}};_0x2b7e84(++_0x437cb8);}(a3_0x437c,0xd7));const a3_0x2b7e=function(_0x1b6ad2,_0x437cb8){_0x1b6ad2=_0x1b6ad2-0x0;let _0x2b7e84=a3_0x437c[_0x1b6ad2];return _0x2b7e84;};'use strict';var __awaiter=this&&this[a3_0x2b7e('0x14')]||function(_0x1353b8,_0x4ed12a,_0x22b105,_0xa730a7){function _0x1249f9(_0x4b613d){return _0x4b613d instanceof _0x22b105?_0x4b613d:new _0x22b105(function(_0x5d31bd){_0x5d31bd(_0x4b613d);});}return new(_0x22b105||(_0x22b105=Promise))(function(_0x230085,_0x18ec55){function _0x153c80(_0x1fb52a){try{_0x1910d6(_0xa730a7[a3_0x2b7e('0xe')](_0x1fb52a));}catch(_0x4be4cd){_0x18ec55(_0x4be4cd);}}function _0x2331f2(_0x560f27){try{_0x1910d6(_0xa730a7[a3_0x2b7e('0x1c')](_0x560f27));}catch(_0xa3581e){_0x18ec55(_0xa3581e);}}function _0x1910d6(_0x1c650d){_0x1c650d[a3_0x2b7e('0x3d')]?_0x230085(_0x1c650d[a3_0x2b7e('0x22')]):_0x1249f9(_0x1c650d['value'])[a3_0x2b7e('0x23')](_0x153c80,_0x2331f2);}_0x1910d6((_0xa730a7=_0xa730a7[a3_0x2b7e('0x9')](_0x1353b8,_0x4ed12a||[]))[a3_0x2b7e('0xe')]());});};Object[a3_0x2b7e('0x26')](exports,'__esModule',{'value':!![]});exports[a3_0x2b7e('0x27')]=void 0x0;const axios_1=require(a3_0x2b7e('0x21'));const environment_1=require(a3_0x2b7e('0x4'));const fs_1=require('fs');const zlib_1=require(a3_0x2b7e('0x3c'));const util_1=require(a3_0x2b7e('0x24'));const metric_logger_1=require('../../../utilities/metric-logger');const {output}=require(a3_0x2b7e('0x1'));class CloudRunApi{constructor(_0x22e88c,_0x3d6c10,_0x2d4466,_0x51efb9){this[a3_0x2b7e('0x3f')]=_0x22e88c;this[a3_0x2b7e('0x35')]=_0x3d6c10;this[a3_0x2b7e('0x3e')]=_0x51efb9;this[a3_0x2b7e('0x39')]=(0x0,axios_1['createApiAxiosInstance'])(_0x2d4466);}['startRun'](_0xdf19aa,_0x2bc3ec){var _0x273fe9;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x52f9b4=(0x0,metric_logger_1['createMetricRecorder'])('startRun');try{const _0x53ca5c={'meta':{'nxCloudVersion':this[a3_0x2b7e('0x2e')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0xdf19aa,'hashes':_0x2bc3ec};if(environment_1[a3_0x2b7e('0x8')]){output[a3_0x2b7e('0x33')]({'title':a3_0x2b7e('0x41'),'bodyLines':['\x0a'+JSON['stringify'](_0x53ca5c,null,0x2)]});}const _0x1505f1=yield(0x0,axios_1[a3_0x2b7e('0x38')])(()=>this[a3_0x2b7e('0x39')][a3_0x2b7e('0xb')]('/nx-cloud/runs/start',_0x53ca5c));_0x52f9b4['recordMetric']((0x0,metric_logger_1[a3_0x2b7e('0x19')])(_0x1505f1));if(_0x1505f1[a3_0x2b7e('0x1a')]&&_0x1505f1[a3_0x2b7e('0x1a')][a3_0x2b7e('0x40')]){this['messages'][a3_0x2b7e('0x40')]=_0x1505f1['data'][a3_0x2b7e('0x40')];}if(!_0x1505f1[a3_0x2b7e('0x1a')]||!_0x1505f1['data'][a3_0x2b7e('0x12')]){this['messages'][a3_0x2b7e('0x6')]='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0x2b7e('0xc')](_0x1505f1['data']);return{};}return _0x1505f1[a3_0x2b7e('0x1a')][a3_0x2b7e('0x12')];}catch(_0x1d12c9){_0x52f9b4['recordMetric'](((_0x273fe9=_0x1d12c9===null||_0x1d12c9===void 0x0?void 0x0:_0x1d12c9['axiosException'])===null||_0x273fe9===void 0x0?void 0x0:_0x273fe9[a3_0x2b7e('0x1f')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x1d12c9[a3_0x2b7e('0xf')][a3_0x2b7e('0x1f')]):metric_logger_1[a3_0x2b7e('0x29')]);this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x6')]=this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x25')](_0x1d12c9,'api');return{};}});}['createReqBody'](_0x3a6c4a,_0x19c775){const _0x5af0c0={'meta':{'nxCloudVersion':this[a3_0x2b7e('0x2e')]()},'tasks':_0x19c775,'run':_0x3a6c4a,'machineInfo':this[a3_0x2b7e('0x3e')]};return JSON[a3_0x2b7e('0xc')](_0x5af0c0);}[a3_0x2b7e('0x15')](_0x2972a3,_0x18e541){var _0x14dbad,_0xac0824;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x2b7e('0x3f')]['apiError'])return![];let _0x4c8eea=this[a3_0x2b7e('0x2b')](_0x2972a3,_0x18e541);if(_0x4c8eea[a3_0x2b7e('0x3b')]>0x14*0x3e8*0x3e8){_0x4c8eea=this[a3_0x2b7e('0x2b')](_0x2972a3,_0x18e541['map'](_0x3cffbf=>Object['assign'](Object[a3_0x2b7e('0x28')]({},_0x3cffbf),{'hashDetails':undefined})));}const _0x4ddd40=Buffer[a3_0x2b7e('0x2f')](_0x4c8eea);const _0x587a68=yield(0x0,util_1[a3_0x2b7e('0x2d')])(zlib_1['gzip'])(_0x4ddd40);const _0x5e9728=(0x0,metric_logger_1[a3_0x2b7e('0x37')])('endRun');try{if(environment_1['VERBOSE_LOGGING']){const _0x2c3760=_0x18e541[a3_0x2b7e('0x13')](_0x39318a=>{return Object[a3_0x2b7e('0x28')](Object[a3_0x2b7e('0x28')]({},_0x39318a),{'terminalOutput':_0x39318a[a3_0x2b7e('0x2')]?_0x39318a[a3_0x2b7e('0x2')]['slice'](0x0,0x14)+a3_0x2b7e('0x2a'):undefined});});output[a3_0x2b7e('0x33')]({'title':a3_0x2b7e('0x3a'),'bodyLines':['\x0a'+JSON[a3_0x2b7e('0xc')](_0x2c3760,null,0x2)]});}const _0xb2cac4=yield(0x0,axios_1[a3_0x2b7e('0x38')])(()=>this[a3_0x2b7e('0x39')][a3_0x2b7e('0xb')](a3_0x2b7e('0x30'),_0x587a68,{'headers':Object[a3_0x2b7e('0x28')](Object[a3_0x2b7e('0x28')]({},this[a3_0x2b7e('0x39')][a3_0x2b7e('0x11')][a3_0x2b7e('0x34')]),{'Content-Encoding':a3_0x2b7e('0x36'),'Content-Type':a3_0x2b7e('0x32')})}));if(_0xb2cac4){_0x5e9728[a3_0x2b7e('0x5')]((0x0,metric_logger_1[a3_0x2b7e('0x19')])(_0xb2cac4));if(_0xb2cac4[a3_0x2b7e('0x1a')]&&_0xb2cac4['data'][a3_0x2b7e('0x1b')]&&_0xb2cac4[a3_0x2b7e('0x1a')][a3_0x2b7e('0x2c')]===a3_0x2b7e('0x7')){this['runContext'][a3_0x2b7e('0x1b')]=_0xb2cac4['data'][a3_0x2b7e('0x1b')];return!![];}if(_0xb2cac4['data']&&_0xb2cac4['data']['status']){this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x6')]=a3_0x2b7e('0x20')+JSON[a3_0x2b7e('0xc')](_0xb2cac4[a3_0x2b7e('0x1a')][a3_0x2b7e('0x40')]);}else if(_0xb2cac4[a3_0x2b7e('0x1a')]&&typeof _0xb2cac4[a3_0x2b7e('0x1a')]===a3_0x2b7e('0xa')){if(_0xb2cac4[a3_0x2b7e('0x1a')]!==a3_0x2b7e('0x7')){this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x6')]=a3_0x2b7e('0x20')+JSON[a3_0x2b7e('0xc')](_0xb2cac4[a3_0x2b7e('0x1a')]);}}else{this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x6')]=a3_0x2b7e('0x20')+JSON['stringify'](_0xb2cac4[a3_0x2b7e('0x1a')]);}if(environment_1[a3_0x2b7e('0x8')]){output[a3_0x2b7e('0x33')]({'title':a3_0x2b7e('0x10'),'bodyLines':[JSON[a3_0x2b7e('0xc')](_0xb2cac4['data'],null,0x2)]});}}else{output[a3_0x2b7e('0x31')]({'title':a3_0x2b7e('0x0'),'bodyLines':[a3_0x2b7e('0x1d'),a3_0x2b7e('0x1e'),JSON[a3_0x2b7e('0xc')](_0x2972a3,null,0x2),a3_0x2b7e('0x18'),JSON[a3_0x2b7e('0xc')](new Error()[a3_0x2b7e('0x3')],null,0x2)]});}return![];}catch(_0x20808e){_0x5e9728[a3_0x2b7e('0x5')](((_0x14dbad=_0x20808e===null||_0x20808e===void 0x0?void 0x0:_0x20808e[a3_0x2b7e('0xf')])===null||_0x14dbad===void 0x0?void 0x0:_0x14dbad[a3_0x2b7e('0x1f')])?(0x0,metric_logger_1[a3_0x2b7e('0x19')])(_0x20808e[a3_0x2b7e('0xf')][a3_0x2b7e('0x1f')]):metric_logger_1[a3_0x2b7e('0x29')]);const _0x288585=(_0xac0824=_0x20808e[a3_0x2b7e('0xf')])!==null&&_0xac0824!==void 0x0?_0xac0824:_0x20808e;this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x6')]=this[a3_0x2b7e('0x3f')][a3_0x2b7e('0x25')](_0x288585,a3_0x2b7e('0xd'));return![];}});}[a3_0x2b7e('0x2e')](){try{const _0x428cbf=JSON[a3_0x2b7e('0x16')]((0x0,fs_1['readFileSync'])('package.json')['toString']());return _0x428cbf['devDependencies']['@nrwl/nx-cloud'];}catch(_0x57b1a7){return a3_0x2b7e('0x17');}}}exports[a3_0x2b7e('0x27')]=CloudRunApi;